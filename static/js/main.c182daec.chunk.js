(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{107:function(e,t,a){e.exports=a(199)},112:function(e,t,a){},118:function(e,t,a){},199:function(e,t,a){"use strict";a.r(t);var n,r=a(0),c=a.n(r),l=a(9),o=a.n(l),u=(a(112),a(113),a(114),a(115),a(116),a(117),a(118),a(24)),s={itemListByDate:{},totalList:[],valueList:[],scrollBottomEvt:0},i=a(102),m=a(25);!function(e){e.PUT_ITEM="PUT_ITEM",e.LOAD_ITEMS="LOAD_ITEMS",e.SET_ITEMS="SET_ITEMS",e.PUT_TOTAL="PUT_TOTAL",e.LOAD_TOTALS="LOAD_TOTALS",e.SET_TOTALS="SET_TOTALS",e.CALC_TOTAL="CALC_TOTAL",e.SCROLL_BOTTOM="SCROLL_BOTTOM"}(n||(n={}));var d=a(12),f=a.n(d),O=a(11),E=a.n(O),p=function(e){return Math.floor(E()(e).local().hour()/6)},T=function(e,t){return E()(e).local().startOf("days").add(6*(t-1),"hours").format("YYYY-MM-DD")},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case n.SET_ITEMS:var a=t.payload.items,r=f.a.chain(a).groupBy(function(e){return T(e.date,e.timeRangeIndex)}).mapValues(function(e){return f.a.groupBy(e,"timeRangeIndex")}).value();return Object(m.a)({},e,{itemListByDate:r});case n.SET_TOTALS:var c=t.payload.totals,l=Object(i.a)(c);return Object(m.a)({},e,{totalList:l});case n.SCROLL_BOTTOM:return Object(m.a)({},e,{scrollBottomEvt:Date.now()});default:return e}},y=a(32),b=a.n(y),h=a(54),L=a(91),j=a(103),_=a(92),g=a(104),S=new(function(e){function t(){var e;return Object(L.a)(this,t),(e=Object(j.a)(this,Object(_.a)(t).call(this,"SainyoRecorderDatabase"))).items=void 0,e.totals=void 0,e.version(1).stores({items:"++id, date, datetime, timeRangeIndex,value",totals:"++id, date, timeRangeIndex, value, dateKey",values:"++id, value"}),e.items=e.table("items"),e.totals=e.table("totals"),e}return Object(g.a)(t,e),t}(a(93).a)),D=function(){var e=Object(h.a)(b.a.mark(function e(t){var a;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.items.where("datetime").between(E()().local().startOf("days").subtract(3,"days").toDate(),E()().local().endOf("days").toDate()).sortBy("dattime");case 2:a=e.sent,t({type:n.SET_ITEMS,payload:{items:a}});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=Object(h.a)(b.a.mark(function e(t){var a;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.totals.toArray();case 2:a=e.sent,t({type:n.SET_TOTALS,payload:{totals:a}}),t({type:n.SCROLL_BOTTOM});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),A=function(){var e=Object(h.a)(b.a.mark(function e(t,a){var r,c,l,o;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.totals.get(Object(m.a)({},a));case 2:return r=e.sent,c=T(a.date,a.timeRangeIndex),e.next=6,S.items.where(Object(m.a)({},a)).toArray();case 6:return l=e.sent,o=f.a.sumBy(l,"value"),e.next=10,S.totals.put(Object(m.a)({},r,a,{value:o,dateKey:c}));case 10:t({type:n.LOAD_TOTALS});case 11:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),w=function(e,t,a){switch(e.type){case n.PUT_ITEM:var r=e.payload.item,c=r.date,l=r.timeRangeIndex;S.items.put(r);var o={date:c,timeRangeIndex:l};return t({type:n.CALC_TOTAL,payload:{query:o}}),void t({type:n.LOAD_ITEMS});case n.LOAD_ITEMS:return void D(t);case n.CALC_TOTAL:return void A(t,e.payload.query);case n.LOAD_TOTALS:return void I(t)}},M=function(e,t,a,n){return function(r){t(r),a(r,n,e)}},x=Object(r.createContext)({state:s}),C=function(e){var t=e.children,a=function(e,t){var a=Object(u.a)(e,2),n=a[0],c=a[1],l=Object(r.useCallback)(function(e){o(e)},[]),o=Object(r.useCallback)(M(n,c,t,l),[n,c,l]);return[n,o]}(Object(r.useReducer)(v,s),w),l=Object(u.a)(a,2),o=l[0],i=l[1];Object(r.useEffect)(function(){i({type:n.LOAD_ITEMS}),i({type:n.LOAD_TOTALS})},[]);var m={state:o,dispatch:i};return c.a.createElement(x.Provider,{value:m},t)},k=a(10),B=function(e){var t=e.items,a=e.totals,n=e.hasDayTotal,l=e.dateKey,o=e.timeRangeIndex,u=e.hasBottomEl,s=Object(r.useContext)(x).state.scrollBottomEvt,i=Object(r.useRef)(null);Object(r.useEffect)(function(){i.current&&u&&i.current.scrollIntoView({behavior:"smooth"})},[i,s]);var m=f.a.find(a,{dateKey:l,timeRangeIndex:o}),d=NaN;return n&&(d=f.a.chain(a).filter({dateKey:l}).sumBy("value").value()),c.a.createElement(c.a.Fragment,null,t.map(function(e){return c.a.createElement(k.g,{key:e.datetime.getTime()},c.a.createElement(k.c,null,E()(e.datetime).local().format("MM/DD")),c.a.createElement(k.c,null,E()(e.datetime).local().format("HH:mm")),c.a.createElement(k.c,{alignEnd:!0},e.value))}),m&&c.a.createElement(k.g,{className:"table-info"},c.a.createElement(k.c,null,E()(m.date).format("MM/DD")),c.a.createElement(k.c,null,function(e){return"".concat(E()().local().startOf("days").add(6*e,"hours").format("HH:mm"),"-").concat(E()().local().startOf("days").add(6*(e+1),"hours").format("HH:mm"))}(m.timeRangeIndex)),c.a.createElement(k.c,{alignEnd:!0},m.value)),!Number.isNaN(d)&&c.a.createElement(k.g,{className:"table-success",ref:i},c.a.createElement(k.c,null,E()(l).format("MM/DD")),c.a.createElement(k.c,null,"\u5408\u8a08(06:00-06:00)"),c.a.createElement(k.c,{alignEnd:!0},d)))},R=function(){var e=Object(r.useContext)(x).state,t=e.totalList,a=e.itemListByDate,n=f.a.last(t),l=(n?n.dateKey:E()().local().format("YYYY-MM-DD"),[]);return f.a.isEmpty(a)||(l=f.a.chain(a).keys().sort().map(function(e){return{dateKey:e,items:a[e]}}).map(function(e){var t=e.dateKey,a=e.items,n=f.a.keys(a).length;return f.a.chain(a).keys().map(Number).sort(function(e,t){return 0===e?1:0===t?-1:e>t?1:e<t?-1:0}).map(function(e,r){return{dateKey:t,timeRangeIndex:e,items:a[e],hasDayTotal:r+1===n,hasBottomEl:!1}}).value()}).flatten().value(),f.a.set(f.a.last(l)||{},"hasBottomEl",!0)),c.a.createElement(k.a,{stickyRows:1,style:{height:"calc(100vh - 100px)"}},c.a.createElement(k.d,null,c.a.createElement(k.e,null,c.a.createElement(k.g,null,c.a.createElement(k.f,null,"\u65e5\u4ed8"),c.a.createElement(k.f,null,"\u6642\u9593"),c.a.createElement(k.f,null,"\u63a1\u5c3f\u91cf"))),c.a.createElement(k.b,null,l.map(function(e){return c.a.createElement(B,Object.assign({},e,{key:"".concat(e.dateKey,"-").concat(e.timeRangeIndex),totals:t}))}))))},N=a(101),Y=a(26),K=a(100),P=a.n(K),H=a(75),U=a.n(H),V=a(8),W=a.n(V),q=function(){var e=Object(r.useState)(!1),t=Object(u.a)(e,2),a=t[0],l=t[1],o=Object(r.useState)(new Date),s=Object(u.a)(o,2),i=s[0],m=s[1],d=Object(r.useState)(""),f=Object(u.a)(d,2),O=f[0],T=f[1],v=Object(r.useContext)(x),y=(v.state,v.dispatch),b=Object(r.useCallback)(function(){m(new Date),l(!0)},[l]),h=Object(r.useCallback)(function(){l(!1)},[l]),L=Object(r.useCallback)(function(e){m(e)},[m]),j=Object(r.useCallback)(function(e){T(e)},[T]),_=Object(r.useCallback)(function(){var e=Number(O)||0;if(e>0&&y){var t={datetime:i,date:E()(i).format("YYYY-MM-DD"),value:e,timeRangeIndex:p(i)};y({type:n.PUT_ITEM,payload:{item:t}}),T(""),l(!1)}},[y,i,O,l]);return c.a.createElement("div",{className:W()(U.a.top)},c.a.createElement(N.a,{icon:"add",onClick:b}),c.a.createElement(Y.e,{closable:!0,popup:!0,visible:a,animationType:"slide-up",onClose:h,className:W()(U.a.modal)},c.a.createElement(Y.d,{renderHeader:"\u63a1\u5c3f\u91cf\u5165\u529b"},c.a.createElement(Y.b,{locale:P.a,value:i,onChange:L},c.a.createElement(Y.d.Item,null,"\u65e5\u6642")),c.a.createElement(Y.c,{type:"number",onChange:j,defaultValue:O},"\u63a1\u5c3f\u91cf"),c.a.createElement(Y.d.Item,null,c.a.createElement(Y.a,{onClick:_,type:"primary"},"\u767b\u9332")))))},J=function(){return c.a.createElement(C,null,c.a.createElement("div",{className:"container"},c.a.createElement("header",null,"\u63a1\u5c3f\u91cf\u30ec\u30b3\u30fc\u30c0\u30fc"),c.a.createElement(R,null)),c.a.createElement(q,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(c.a.createElement(J,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},75:function(e,t,a){e.exports={top:"InputButton_top__1PvaW",modal:"InputButton_modal__4hQtw"}}},[[107,1,2]]]);
//# sourceMappingURL=main.c182daec.chunk.js.map