(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{101:function(e,t,a){e.exports={top:"InputButton_top__1PvaW"}},107:function(e,t,a){e.exports=a(199)},112:function(e,t,a){},118:function(e,t,a){},199:function(e,t,a){"use strict";a.r(t);var n,r=a(0),c=a.n(r),l=a(9),o=a.n(l),u=(a(112),a(113),a(114),a(115),a(116),a(117),a(118),a(24)),s={itemList:[],itemListByDate:{},totalList:[],valueList:[],scrollBottomEvt:0},i=a(19),m=a(56);!function(e){e.PUT_ITEM="PUT_ITEM",e.LOAD_ITEMS="LOAD_ITEMS",e.SET_ITEMS="SET_ITEMS",e.PUT_TOTAL="PUT_TOTAL",e.LOAD_TOTALS="LOAD_TOTALS",e.SET_TOTALS="SET_TOTALS",e.CALC_TOTAL="CALC_TOTAL",e.SCROLL_BOTTOM="SCROLL_BOTTOM"}(n||(n={}));var d=a(29),O=a.n(d),f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case n.PUT_ITEM:var a=t.payload.item,r=O.a.sortBy([].concat(Object(m.a)(e.itemList),[a]),"datetime");return Object(i.a)({},e,{itemList:r});case n.SET_ITEMS:var c=t.payload.items,l=Object(m.a)(c);return Object(i.a)({},e,{itemList:l});case n.SET_TOTALS:var o=t.payload.totals,u=Object(m.a)(o);return Object(i.a)({},e,{totalList:u});case n.SCROLL_BOTTOM:return Object(i.a)({},e,{scrollBottomEvt:Date.now()});default:return e}},T=a(32),E=a.n(T),v=a(54),b=a(91),p=a(103),y=a(92),L=a(104),h=new(function(e){function t(){var e;return Object(b.a)(this,t),(e=Object(p.a)(this,Object(y.a)(t).call(this,"SainyoRecorderDatabase"))).items=void 0,e.totals=void 0,e.version(1).stores({items:"++id, date, datetime, timeRangeIndex,value",totals:"++id, date, timeRangeIndex, value, dateKey",values:"++id, value"}),e.items=e.table("items"),e.totals=e.table("totals"),e}return Object(L.a)(t,e),t}(a(93).a)),j=a(11),_=a.n(j),S=function(e){return Math.floor(_()(e).local().hour()/6)},A=function(){var e=Object(v.a)(E.a.mark(function e(t){var a;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.items.where("datetime").between(_()().local().startOf("days").subtract(5,"days").toDate(),_()().local().endOf("days").toDate()).sortBy("dattime");case 2:a=e.sent,t({type:n.SET_ITEMS,payload:{items:a}});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=Object(v.a)(E.a.mark(function e(t){var a;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.totals.toArray();case 2:a=e.sent,t({type:n.SET_TOTALS,payload:{totals:a}});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=Object(v.a)(E.a.mark(function e(t,a){var r,c,l,o;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.totals.get(Object(i.a)({},a));case 2:return r=e.sent,u=a.date,s=a.timeRangeIndex,c=_()(u).local().startOf("days").add(6*(s-1),"hours").format("YYYY-MM-DD"),e.next=6,h.items.where(Object(i.a)({},a)).toArray();case 6:return l=e.sent,o=O.a.sumBy(l,"value"),e.next=10,h.totals.put(Object(i.a)({},r,a,{value:o,dateKey:c}));case 10:t({type:n.LOAD_TOTALS});case 11:case"end":return e.stop()}var u,s},e)}));return function(t,a){return e.apply(this,arguments)}}(),D=function(e,t,a){switch(e.type){case n.PUT_ITEM:var r=e.payload.item,c=r.date,l=r.timeRangeIndex;h.items.put(r);var o={date:c,timeRangeIndex:l};return void t({type:n.CALC_TOTAL,payload:{query:o}});case n.LOAD_ITEMS:return void A(t);case n.CALC_TOTAL:return void w(t,e.payload.query);case n.LOAD_TOTALS:return void M(t)}},g=function(e,t,a,n){return function(r){t(r),a(r,n,e)}},C=Object(r.createContext)({state:s}),I=function(e){var t=e.children,a=function(e,t){var a=Object(u.a)(e,2),n=a[0],c=a[1],l=Object(r.useCallback)(function(e){o(e)},[]),o=Object(r.useCallback)(g(n,c,t,l),[n,c,l]);return[n,o]}(Object(r.useReducer)(f,s),D),l=Object(u.a)(a,2),o=l[0],i=l[1];Object(r.useEffect)(function(){i({type:n.LOAD_ITEMS}),i({type:n.LOAD_TOTALS})},[]);var m={state:o,dispatch:i};return c.a.createElement(C.Provider,{value:m},t)},x=a(10),k=function(){var e,t=Object(r.useContext)(C).state,a=t.itemList,n=t.totalList,l=t.scrollBottomEvt,o=O.a.last(n),u=o?o.dateKey:_()().local().format("YYYY-MM-DD"),s=O.a.chain(n).filter({dateKey:u}).sumBy("value").valueOf(),i=Object(r.useRef)(null);return Object(r.useEffect)(function(){console.log("btm",i),i.current&&i.current.scrollIntoView({behavior:"smooth"})},[i,l]),c.a.createElement(x.a,{stickyRows:1,style:{height:"calc(100vh - 100px)"}},c.a.createElement(x.d,null,c.a.createElement(x.e,null,c.a.createElement(x.g,null,c.a.createElement(x.f,null,"\u65e5\u4ed8"),c.a.createElement(x.f,null,"\u6642\u9593"),c.a.createElement(x.f,null,"\u63a1\u5c3f\u91cf"))),c.a.createElement(x.b,null,a.map(function(e){return c.a.createElement(x.g,{key:e.datetime.getTime()},c.a.createElement(x.c,null,_()(e.datetime).local().format("MM/DD")),c.a.createElement(x.c,null,_()(e.datetime).local().format("HH:mm")),c.a.createElement(x.c,{alignEnd:!0},e.value))}),o&&c.a.createElement(c.a.Fragment,null,c.a.createElement(x.g,{className:"table-info"},c.a.createElement(x.c,null,_()(o.date).format("MM/DD")),c.a.createElement(x.c,null,(e=o.timeRangeIndex,"".concat(_()().local().startOf("days").add(6*e,"hours").format("HH:mm"),"-").concat(_()().local().startOf("days").add(6*(e+1),"hours").format("HH:mm")))),c.a.createElement(x.c,{alignEnd:!0},o.value)),c.a.createElement(x.g,{ref:i,className:"table-success"},c.a.createElement(x.c,null,_()(o.dateKey).format("MM/DD")),c.a.createElement(x.c,null,"\u5408\u8a08(06:00-06:00)"),c.a.createElement(x.c,{alignEnd:!0},s))))))},B=a(102),R=a(25),Y=a(100),P=a.n(Y),H=a(101),U=a.n(H),K=a(8),N=a.n(K),W=function(){var e=Object(r.useState)(!1),t=Object(u.a)(e,2),a=t[0],l=t[1],o=Object(r.useState)(new Date),s=Object(u.a)(o,2),i=s[0],m=s[1],d=Object(r.useState)(""),O=Object(u.a)(d,2),f=O[0],T=O[1],E=Object(r.useContext)(C),v=(E.state,E.dispatch),b=Object(r.useCallback)(function(){m(new Date),l(!0)},[l]),p=Object(r.useCallback)(function(){l(!1)},[l]),y=Object(r.useCallback)(function(e){m(e)},[m]),L=Object(r.useCallback)(function(e){T(e)},[T]),h=Object(r.useCallback)(function(){var e=Number(f)||0;if(e>0&&v){var t={datetime:i,date:_()(i).format("YYYY-MM-DD"),value:e,timeRangeIndex:S(i)};v({type:n.PUT_ITEM,payload:{item:t}}),T(""),l(!1),v({type:n.SCROLL_BOTTOM})}},[v,i,f,l]);return c.a.createElement("div",{className:N()(U.a.top)},c.a.createElement(B.a,{icon:"add",onClick:b}),c.a.createElement(R.e,{popup:!0,visible:a,animationType:"slide-up",onClose:p},c.a.createElement(R.d,{renderHeader:"\u63a1\u5c3f\u91cf\u5165\u529b"},c.a.createElement(R.b,{locale:P.a,value:i,onChange:y},c.a.createElement(R.d.Item,null,"\u65e5\u6642")),c.a.createElement(R.c,{type:"number",onChange:L,defaultValue:f},"\u63a1\u5c3f\u91cf"),c.a.createElement(R.d.Item,null,c.a.createElement(R.a,{onClick:h,type:"primary"},"\u767b\u9332")))))},q=function(){return c.a.createElement(I,null,c.a.createElement("div",{className:"container"},c.a.createElement("header",null,"\u63a1\u5c3f\u91cf\u30ec\u30b3\u30fc\u30c0\u30fc"),c.a.createElement(k,null)),c.a.createElement(W,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(c.a.createElement(q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[107,1,2]]]);
//# sourceMappingURL=main.37d52d22.chunk.js.map